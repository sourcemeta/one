macro(sourcemeta_one_test_cli program name)
  if(UNIX)
    add_test(NAME one.${program}.${name} COMMAND
      "${CMAKE_CURRENT_SOURCE_DIR}/${program}/${name}.sh"
      "$<TARGET_FILE:sourcemeta_one_${program}>"
      "${ONE_VERSION}"
      WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}")
    set_tests_properties(one.${program}.${name} PROPERTIES
      ENVIRONMENT "ONE_PREFIX=${ONE_PREFIX}")
  endif()
endmacro()

if(ONE_INDEX)
  sourcemeta_one_test_cli(index bundle-ref-no-fragment)
  sourcemeta_one_test_cli(index extend-builtin-not-found)
  sourcemeta_one_test_cli(index external-reference)
  sourcemeta_one_test_cli(index invalid-configuration)
  sourcemeta_one_test_cli(index invalid-schema)
  sourcemeta_one_test_cli(index invalid-schema-top-level-ref-draft7)
  sourcemeta_one_test_cli(index invalid-schema-uri-percentage)
  sourcemeta_one_test_cli(index invalid-url-option-relative)
  sourcemeta_one_test_cli(index invalid-url-option-urn)
  sourcemeta_one_test_cli(index invalid-url-option-non-http)
  sourcemeta_one_test_cli(index invalid-url-option-no-value)
  sourcemeta_one_test_cli(index output-non-directory)
  sourcemeta_one_test_cli(index extra-files-on-rebuild)
  sourcemeta_one_test_cli(index extra-directories-on-rebuild)
  sourcemeta_one_test_cli(index directory-schema-same-name)
  sourcemeta_one_test_cli(index rebuild-cache)
  sourcemeta_one_test_cli(index rebuild-to-empty)
  sourcemeta_one_test_cli(index verbose-long)
  sourcemeta_one_test_cli(index verbose-short)
  sourcemeta_one_test_cli(index no-base-uri)
  sourcemeta_one_test_cli(index no-options)
  sourcemeta_one_test_cli(index no-output)
endif()
