macro(sourcemeta_one_test_cli directory program name)
  if(UNIX)
    add_test(NAME one.${program}.${directory}.${name} COMMAND
      "${CMAKE_CURRENT_SOURCE_DIR}/${program}/${directory}/${name}.sh"
      "$<TARGET_FILE:sourcemeta_one_${program}>"
      "${ONE_VERSION}"
      WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}")
    set_tests_properties(one.${program}.${directory}.${name} PROPERTIES
      ENVIRONMENT "ONE_PREFIX=${ONE_PREFIX}")
  endif()
endmacro()

if(ONE_INDEX)
  sourcemeta_one_test_cli(common index bundle-ref-no-fragment)
  sourcemeta_one_test_cli(common index extend-builtin-not-found)
  sourcemeta_one_test_cli(common index external-reference)
  sourcemeta_one_test_cli(common index invalid-configuration)
  sourcemeta_one_test_cli(common index invalid-schema)
  sourcemeta_one_test_cli(common index invalid-schema-top-level-ref-draft7)
  sourcemeta_one_test_cli(common index invalid-schema-uri-percentage)
  sourcemeta_one_test_cli(common index invalid-url-option-relative)
  sourcemeta_one_test_cli(common index invalid-url-option-urn)
  sourcemeta_one_test_cli(common index invalid-url-option-non-http)
  sourcemeta_one_test_cli(common index invalid-url-option-no-value)
  sourcemeta_one_test_cli(common index output-non-directory)
  sourcemeta_one_test_cli(common index extra-files-on-rebuild)
  sourcemeta_one_test_cli(common index extra-directories-on-rebuild)
  sourcemeta_one_test_cli(common index directory-schema-same-name)
  sourcemeta_one_test_cli(common index rebuild-cache)
  sourcemeta_one_test_cli(common index rebuild-to-empty)
  sourcemeta_one_test_cli(common index verbose-long)
  sourcemeta_one_test_cli(common index verbose-short)
  sourcemeta_one_test_cli(common index configuration-long)
  sourcemeta_one_test_cli(common index configuration-short)
  sourcemeta_one_test_cli(common index no-base-uri)

  if(ONE_ENTERPRISE)
    sourcemeta_one_test_cli(enterprise index no-options)
    sourcemeta_one_test_cli(enterprise index no-output)
    sourcemeta_one_test_cli(enterprise index sourcemeta-std)
    sourcemeta_one_test_cli(enterprise index lint-rule-not-found)
    sourcemeta_one_test_cli(enterprise index lint-rule-no-title)
    sourcemeta_one_test_cli(enterprise index lint-rule-invalid-title)
    sourcemeta_one_test_cli(enterprise index lint-rule-no-dialect)
  else()
    sourcemeta_one_test_cli(community index no-options)
    sourcemeta_one_test_cli(community index no-output)
    sourcemeta_one_test_cli(community index sourcemeta-std)
    sourcemeta_one_test_cli(community index lint-rule-enterprise-only)
  endif()
endif()
