{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.sourcemeta.com/sourcemeta/std/v0/ietf/uri/uri",
  "title": "RFC 3986 Uniform Resource Identifier (URI)",
  "description": "A unique sequence of characters that identifies an abstract or physical resource",
  "examples": [
    "urn:example:foo",
    "https://example.com/path/to/resource?query=value#section",
    "mailto:user@example.com",
    "tel:+1-555-555-5555"
  ],
  "x-license": "https://github.com/sourcemeta/std/blob/main/LICENSE",
  "x-links": [ "https://www.rfc-editor.org/rfc/rfc3986#section-3" ],
  "anyOf": [
    {
      "$ref": "./urn"
    },
    {
      "$ref": "./url"
    },
    {
      "$comment": "Other absolute URI schemas that are neither URLs nor URNs (i.e. mailto, tel, data, news)",
      "type": "string",
      "not": {
        "$comment": "Not a URL (no authority)",
        "pattern": "^[A-Za-z][A-Za-z0-9+\\-.]*://"
      },
      "pattern": "^[A-Za-z][A-Za-z0-9+\\-.]*:.*$"
    }
  ],
  "$defs": {
    "https://schemas.sourcemeta.com/sourcemeta/std/v0/ietf/uri/urn": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "$id": "https://schemas.sourcemeta.com/sourcemeta/std/v0/ietf/uri/urn",
      "title": "RFC 8141 Uniform Resource Name (URN)",
      "description": "A non-locatable Uniform Resource Identifier (URI) that uses the urn scheme",
      "examples": [
        "urn:example:foo",
        "URN:example:foo/bar",
        "urn:a:b",
        "urn:12345:abcde",
        "urn:1-234:foo",
        "urn:IsBn:2000",
        "urn:example:under_score",
        "urn:ex:!*'();:@&=+$,.-",
        "urn:example:hello%20world",
        "urn:example:%3A%41",
        "urn:example:foo:bar:baz",
        "urn:example:foo/bar/"
      ],
      "x-license": "https://github.com/sourcemeta/std/blob/main/LICENSE",
      "x-links": [ "https://www.rfc-editor.org/rfc/rfc8141#section-2" ],
      "type": "string",
      "not": {
        "$comment": "Disallow reserved NID value 'urn'",
        "pattern": "^[Uu][Rr][Nn]:[Uu][Rr][Nn]:"
      },
      "pattern": "^[Uu][Rr][Nn]:([A-Za-z0-9]([A-Za-z0-9\\-]{0,30}[A-Za-z0-9])?):((%[0-9A-Fa-f]{2}|[A-Za-z0-9\\-._~!$&'()*+,;=:@/])+)(?:\\?(?:\\+[^?#]*)?)?(?:\\?=[^#]*)?(?:#.*)?$",
      "format": "uri"
    },
    "https://schemas.sourcemeta.com/sourcemeta/std/v0/ietf/uri/url": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "$id": "https://schemas.sourcemeta.com/sourcemeta/std/v0/ietf/uri/url",
      "title": "RFC 3986 Uniform Resource Locator (URL)",
      "description": "A locatable absolute Uniform Resource Identifier (URI)",
      "examples": [
        "https://example.com/path/to/resource?query=value#section",
        "http://user:pass@192.168.1.1:8080/api/v1",
        "ftp://ftp.example.org/pub/files/document.pdf",
        "http://[2001:db8::8a2e:370:7334]/ipv6/test",
        "custom+scheme://host.example.com/resource"
      ],
      "x-license": "https://github.com/sourcemeta/std/blob/main/LICENSE",
      "x-links": [ "https://www.rfc-editor.org/rfc/rfc3986#section-3" ],
      "type": "string",
      "anyOf": [
        {
          "$comment": "With authority (//...)",
          "allOf": [
            {
              "$comment": "Valid authority structure - host can be empty",
              "pattern": "^[^:]+://(?:[^@/]*@)?(?:\\[[^\\]]+\\]|[^:/]*)(?::[0-9]*)?(?:/.*|[?#].*)?$"
            }
          ],
          "anyOf": [
            {
              "$comment": "Empty host",
              "pattern": "^[^:]+://(?:[^@/]*@)?(?:/|$)"
            },
            {
              "$comment": "IPv6 in brackets",
              "pattern": "^[^:]+://(?:[^@]*@)?\\[[0-9A-Fa-f:.]+\\]"
            },
            {
              "$comment": "Valid IPv4 - check each octet",
              "not": {
                "pattern": "^[^:]+://(?:[^@]*@)?(?:(?:25[6-9]|2[6-9][0-9]|[3-9][0-9]{2}|[1-9][0-9]{3,})[.]|[.](?:25[6-9]|2[6-9][0-9]|[3-9][0-9]{2}|[1-9][0-9]{3,})[.]|[.](?:25[6-9]|2[6-9][0-9]|[3-9][0-9]{2}|[1-9][0-9]{3,})[.]|[.](?:25[6-9]|2[6-9][0-9]|[3-9][0-9]{2}|[1-9][0-9]{3,})(?:[:/]|$))"
              },
              "pattern": "^[^:]+://(?:[^@]*@)?[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+(?:[:/?#]|$)"
            },
            {
              "$comment": "Domain or reg-name (not IPv4)",
              "not": {
                "pattern": "^[^:]+://(?:[^@]*@)?[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+(?:[:/]|$)"
              },
              "pattern": "^[^:]+://(?:[^@]*@)?[A-Za-z0-9.-]+(?:[:/?#]|$)"
            }
          ],
          "pattern": "^[A-Za-z][A-Za-z0-9+\\-.]*://"
        },
        {
          "$comment": "Without authority (path-absolute/rootless/empty)",
          "not": {
            "pattern": "^[^:]+://"
          },
          "pattern": "^[A-Za-z][A-Za-z0-9+\\-.]*:(?:/[^?#]*)?(?:\\?[^#]*)?(?:#.*)?$"
        }
      ],
      "not": {
        "anyOf": [
          {
            "$comment": "Disallow spaces and control characters anywhere",
            "pattern": "[\\x00-\\x20]"
          },
          {
            "$comment": "Valid percent-encoding throughout",
            "pattern": "%(?![0-9A-Fa-f]{2})"
          }
        ]
      },
      "pattern": "^[A-Za-z][A-Za-z0-9+\\-.]*:.*$",
      "format": "uri"
    }
  }
}
